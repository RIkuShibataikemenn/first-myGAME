<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Choosing the one who will face the penalty！</title>

<style>
    body {
        background: #ffeef5;
        text-align: center;
        margin-top: 30px;
        font-family: sans-serif;
        overflow-x: hidden;
    }

    h2 {
        font-size: 22px;
        margin-bottom: 20px;
    }

    /* 5×6 グリッド */
    #gameArea {
        display: grid;
        grid-template-columns: repeat(5, 120px);
        grid-template-rows: repeat(6, 120px);
        gap: 12px;
        justify-content: center;
    }

    /* ボタン画像 */
    .surprise-img {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        cursor: pointer;
        animation: dance 1.2s infinite ease-in-out;
        transition: opacity .3s, transform .3s;
        box-shadow: 0 0 10px rgba(255, 0, 90, 0.3);
    }

    /* リズムアニメ */
    @keyframes dance {
        0%   { transform: scale(1) rotate(0deg); }
        25%  { transform: scale(1.06) rotate(4deg); }
        50%  { transform: scale(0.95) rotate(-4deg); }
        75%  { transform: scale(1.06) rotate(2deg); }
        100% { transform: scale(1) rotate(0deg); }
    }

    /* 全画面ポップアップ */
    #popup {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.9);
        z-index: 999;
        justify-content: center;
        align-items: center;
        animation: fadeIn 0.4s ease-out;
    }

    /* 背景フェードイン */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* 画像「ドーン」 */
    #popupImg {
        max-width: 95vw;
        max-height: 90vh;
        border-radius: 15px;
        animation: boom 0.6s cubic-bezier(0.18,1.4,0.32,1.0);
        box-shadow: 0 0 25px rgba(255,255,255,0.8);
    }

    @keyframes boom {
        0%   { transform: scale(0.1) rotate(12deg); opacity: 0; }
        50%  { transform: scale(1.3) rotate(-6deg); opacity: 1; }
        100% { transform: scale(1) rotate(0deg); }
    }

    /* 画面を震わせる */
    .shake {
        animation: shakeAnim 0.4s ease-in-out 0s 1;
    }

    @keyframes shakeAnim {
        0%   { transform: translate(0,0); }
        20%  { transform: translate(-10px, 6px); }
        40%  { transform: translate(12px, -8px); }
        60%  { transform: translate(-8px, 4px); }
        80%  { transform: translate(6px, -6px); }
        100% { transform: translate(0,0); }
    }

    /* 光フラッシュ */
    #flashEffect {
        display: none;
        position: fixed;
        inset: 0;
        background: white;
        opacity: 0;
        z-index: 1200;
        pointer-events: none;
    }

    .flash {
        animation: flashAnim 0.3s forwards;
    }

    @keyframes flashAnim {
        0% { opacity: 0; }
        40% { opacity: 1; }
        100% { opacity: 0; }
    }

    /* 閉じるボタン */
    #closePopup {
        margin-top: 18px;
        padding: 10px 25px;
        border: none;
        background: #ff6688;
        color: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 18px;
        box-shadow: 0 0 10px rgba(255,0,100,0.4);
    }
</style>
</head>
<body>

<h2>Choosing the one who will face the penalty！</h2>

<!-- BGM -->
<audio id="bgm" src="bgm.mp3" loop></audio>

<!-- 外れ音 -->
<audio id="surpriseSound" src="surprise.mp3" preload="auto"></audio>

<!-- グリッド -->
<div id="gameArea"></div>

<!-- 全画面ポップアップ -->
<div id="popup">
    <div>
        <img id="popupImg" src="surprise.jpg">
        <button id="closePopup">閉じる</button>
    </div>
</div>

<!-- フラッシュ効果 -->
<div id="flashEffect"></div>

<script>
    const totalButtons = 30;
    const gameArea = document.getElementById("gameArea");

    const buttonImages = [
        "img/button1.png",
        "img/button2.png",
        "img/button3.png"
    ];

    const loserIndex = Math.floor(Math.random() * totalButtons);

    let bgmStarted = false;

    for (let i = 0; i < totalButtons; i++) {

        const img = document.createElement("img");
        img.className = "surprise-img";
        img.src = buttonImages[Math.floor(Math.random() * buttonImages.length)];
        img.dataset.index = i;

        img.onclick = () => {

            if (!bgmStarted) {
                document.getElementById("bgm").play();
                bgmStarted = true;
            }

            img.style.opacity = 0;
            img.style.transform = "scale(0.6)";
            setTimeout(() => img.remove(), 300);

            if (i == loserIndex) {

                document.getElementById("surpriseSound").play();

                /* 画面揺れ */
                document.body.classList.add("shake");
                setTimeout(() => document.body.classList.remove("shake"), 500);

                /* 光フラッシュ */
                const flash = document.getElementById("flashEffect");
                flash.style.display = "block";
                flash.classList.add("flash");
                setTimeout(() => {
                    flash.classList.remove("flash");
                    flash.style.display = "none";
                }, 300);

                /* 全画面ポップアップ */
                document.getElementById("popup").style.display = "flex";
            }
        };

        gameArea.appendChild(img);
    }

    document.getElementById("closePopup").onclick = () => {
        document.getElementById("popup").style.display = "none";
    };
</script>

</body>
</html>
